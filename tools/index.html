<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>DWD 147.7kHz Messages</title>
  <style>
  body {
         background-color: black;
    color: seagreen;
  }
  #navtex, div#top {
        font-family: "Lucida Console", "Menlo", "Monaco", "Courier", monospace;
        padding-top: 11px;
  }
  div#top {
        position: fixed;
    	background-color: rgb(0 0 0 / 100%);
    	-moz-box-shadow: 0px 6px 6px 0px rgba(255, 255, 255, 0.25);
    	-webkit-box-shadow: 0px 6px 6px 0px rgba(255, 255, 255, 0.25);
    	box-shadow: 0px 6px 6px 0px rgba(255, 255, 255, 0.25);
    	width: 100%;
    	padding: 8px 0px 2px 4px;
    	margin: 0;
    	top: 0;
    	left: 0;
    	height: 22px;
 }
  </style>
</head>
<body>
  <div id="top">
    <form>
      <input id="scroll" type="checkbox" name="scroll" checked> Scroll Page
    </form>
  </div>
  <div id="navtex"></div>
</body>
<script src="jquery-3.7.1.min.js"></script>
  <script>


        const re = new RegExp("\\d{1,2}\\.\\d[NS]\\s+\\d{1,3}\\.\\d[EW]", "g");
        //const re = new RegExp("DDH47", "g");
        var n_div = document.getElementById('navtex');
        var scroll_it = true;
  function connect() {
  var ws = new WebSocket('ws://cantools.flynjk.loc:8765');

  ws.onopen = function() {
    // subscribe to some channels
    ws.send(JSON.stringify({
    }));
  };

  ws.onmessage = function(e) {
    //console.log('Message:', e.data);

        const found = e.data.match(re);
        if (found) {
                console.log(found);
                let ds = '' + e.data;
                ds = ds.replace(re, '<a href="https://maps.google.com/?q=' + encodeURI(found) + '&z=7" target="_blank">' + found + '</a>');
                n_div.innerHTML += ds + '<br>';
        } else {


                n_div.innerHTML += e.data + '<br>';
        }
          if (scroll_it) {
                window.scrollTo(0, document.body.scrollHeight);
          }
  };

  ws.onclose = function(e) {
    console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
    setTimeout(function() {
      connect();
    }, 1000);
  };

  ws.onerror = function(err) {
    console.error('Socket encountered error: ', err.message, 'Closing socket');
    ws.close();
  };
  }

  connect();


        $('#scroll').on('click', function(e) {
                scroll_it = $(this).is(':checked');
                return true;
        });
  </script>

</html>
